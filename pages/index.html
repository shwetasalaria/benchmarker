    <!--
.. title: Stats
.. date: 2018-06-02 09:39:34 UTC
.. tags:
.. category:
.. link:
.. type: text
.. hidetitle: True
.. author: 
.. template: charts.tmpl
.. has_math: yes
-->

<section class="container">
  <h1>Performance measurement results</h1>

  <p> descibe current kernel</p>

 <div class="btn-group">
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Kernel</button>
    <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 56px, 0px); top: 0px; left: 0px; will-change: transform;">
      <a class="dropdown-item" href="#">Primary Key</a>
      <a class="dropdown-item" href="#">Secondary Key</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="#">conv2</a>
      <a class="dropdown-item" href="#">conv3</a>
    </div>
  </div><!-- /btn-group -->
 <div class="btn-group">
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Device</button>
    <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 56px, 0px); top: 0px; left: 0px; will-change: transform;">
      <a class="dropdown-item" href="#">Primary Key</a>
      <a class="dropdown-item" href="#">Secondary Key</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="#">Device 1</a>
      <a class="dropdown-item" href="#">Device 2</a>
    </div>
  </div><!-- /btn-group -->
  <div class="btn-group">
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Framework</button>
    <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 56px, 0px); top: 0px; left: 0px; will-change: transform;">
      <a class="dropdown-item" href="#">Primary Key</a>
      <a class="dropdown-item" href="#">Secondary Key</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="#">Chainer</a>
      <a class="dropdown-item" href="#">Framework 2</a>
    </div>
  </div><!-- /btn-group -->

<canvas id="myChart" width="800" height="450"></canvas>

<script type="text/javascript">
  //flat table w source data ingected by the plugin
var df = new dataForge.DataFrame({
    columnNames: ["kernel", "device", "framework", "perf"],
    rows: [
      ["conv2", 'p100', 'Chainer', 6],
      ["conv2", 'p100', 'TensorFlow', 7],
      ["conv2", 'v100', 'Chainer', 5.5],
      ["conv2", 'v100', 'TensorFlow', 9],
      ["conv2", 'v100', 'theano', 4.4],
      ["conv3", 'p100', 'theano', 1.1]
    ]
  });
</script>

<script>
//the data will be injected by a plugin from SSG side
var prim_key="device"
var sec_key="framework"

var prim_values = df.getColumns().where(column => column.name == prim_key).first().series.distinct().toArray();
var sec_values = df.getColumns().where(column => column.name == sec_key).first().series.distinct().toArray();

filters = {
  "kernel": "conv2"
}

function apply_filters(df, filters)
{
  res = df
  for (var key in filters) 
  {
    // check if the property/key is defined in the object itself, not in parent
    if (filters.hasOwnProperty(key)) 
    {           
      //console.log(key, dictionary[key]);
      res = res.where(row => row[key] == filters[key])
    }
  }
  return res
}

//function get_value()
df = apply_filters(df, filters)

function get_value(df, key, val)
{
  var filtered = df.where(row => row[key] == val)
  var cols = filtered.getColumns().where(column => column.name == "perf").first().series
  return cols.sum()
}

function get_data(df, sec_key, sec_val, prim_key, prim_values) {
  var filtered_df = df.where(row => row[sec_key] == sec_val);
  //var per_sec_key = filtered_df.groupBy(row => row[prim_key]);
  //var result = prim_values.map(i => i * 2);
  //x`result =  [for (i of numbers) if (i % 2 === 0) i * 2];
  var result = prim_values.map(k => get_value(filtered_df, prim_key, k))
  return result
}

function get_rec_per_sec_key(df, sec_key, sec_val, prim_key, prim_values, id_color)
{
  var result = {}
  result["label"] = sec_val
  colors = ["TEAL", "OLIVE", "ORANGE"]
  result["backgroundColor"] = colors[id_color]
  result["data"] = get_data(df, sec_key, sec_val, prim_key, prim_values)
  return result
}


var chart_data = {
    labels: prim_values,
    datasets: sec_values.map((k,i) => get_rec_per_sec_key(df, sec_key, k, prim_key, prim_values, i))
};
</script>

<script>
var ctx = document.getElementById("myChart").getContext("2d");
var color = Chart.helpers.color;

var myBarChart = new Chart(ctx, {
    type: 'bar',
    data: chart_data,
    options: {
        barValueSpacing: 20,
        scales: {
            yAxes: 
            [
            {
                ticks: 
                {
                    min: 0,
                },
                scaleLabel: 
                {
                    display: true,
                    labelString: 'Epoch time'
                }            
            }
            ]
        }
    }
});
</script>


</section>

